<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <div id="outputid"></div>

    <script>

        var snakeBoard = document.createElement('canvas');

        snakeBoard.width = 400;
        snakeBoard.height = 250;
        snakeBoard.style.boxShadow = "12px 13px 24px -2px black";

        document.getElementById("outputid").appendChild(snakeBoard);

        var snakeBoard_ctx = snakeBoard.getContext("2d");

        // var snakeBoardBg = "green";

        var backgroundImage = new Image();
        // backgroundImage.src = './green_grass.jpg';
        backgroundImage.src = './desert.jpg';
        drawBackground();

        var snake_head_col = "#ff8197";
        var snake_col = 'yellow';
        var snake_border = 'red';

        snake = [
            {
                x: 200,
                y: 200
            },
            {
                x: 190,
                y: 200
            },
            {
                x: 180,
                y: 200
            },
            {
                x: 170,
                y: 200
            },
            {
                x: 160,
                y: 200
            }
        ];

        function drawBackground() {
            snakeBoard_ctx.drawImage(
                backgroundImage,
                0,
                0
            );

            /*snakeBoard_ctx.fillStyle = snake_head_col;
            snakeBoard_ctx.fillRect(0, 0, 0, 0); */
        }

        // snakeHead.src = './head.png';
        // snakeHead.src = './snake_head.png';
        // snakeHead.src = './brown_head.png';
        // snakeHead.src = './black_head.webp';
        // snakeHead.src = './yellow_snake.jpg';

        /* var snakeHead1 = new Image();
        var snakeHead2 = new Image();
        var snakeHead3 = new Image();
        var snakeHead4 = new Image();
        snakeHead1.src = './head1.png';
        snakeHead2.src = './head2.png';
        snakeHead3.src = './head3.png';
        snakeHead4.src = './head4.png'; */
        var whichHead = new Image();
        // whichHead.src = './head2.png';
        whichHead.src = './red2.jpg';

        var entered = false;

        function drawSnakePart(snakePart) {

            if (!entered) {

                /* snakeBoard_ctx.fillStyle = snake_head_col;
                snakeBoard_ctx.fillRect(snakePart.x, snakePart.y, 10, 10);
 
                snakeBoard_ctx.strokestyle = snake_border;
                snakeBoard_ctx.strokeRect(snakePart.x, snakePart.y, 10, 10); */

                snakeBoard_ctx.drawImage(
                    whichHead,
                    snakePart.x,
                    snakePart.y,
                    10,
                    11
                );

                entered = true;
            } else {
                snakeBoard_ctx.fillStyle = snake_col;
                snakeBoard_ctx.fillRect(snakePart.x, snakePart.y, 10, 10);

                snakeBoard_ctx.strokestyle = snake_border;
                snakeBoard_ctx.strokeRect(snakePart.x, snakePart.y, 10, 10);
            }

            /* snakeBoard_ctx.fillStyle = "red";
            snakeBoard_ctx.fillRect(snakePart.x, snakePart.y, 10, 10);
            snakeBoard_ctx.fillStyle = snake_col;
            snakeBoard_ctx.fillRect(snakePart.x, snakePart.y, 10, 10); */
        }

        function drawSnake() {
            snake.forEach(drawSnakePart);
        }

        drawSnake();

        var foodImage = new Image();
        // foodImage.src = './red_food.png';
        // foodImage.src = './tomato.png';
        // foodImage.src = './white_egg.png';
        // foodImage.src = './white_egg2.png';
        // foodImage.src = './brown_food.png';
        var list_food = ['./blue_egg.png', './red_food.png', './food1.png', './food2.png', './food.png', './brown_food.png', './tomato.png', './white_egg.png', './white_egg2.png'];

        gen_food();
        drawFood();

        var food_x;
        var food_y;
        var dx = 10;
        var dy = 0;

        function drawFood() {
            // snakeBoard_ctx.fillStyle = 'red';
            // snakeBoard_ctx.strokestyle = 'red';
            // snakeBoard_ctx.fillRect(food_x, food_y, 10, 10);
            // snakeBoard_ctx.strokeRect(food_x, food_y, 10, 10);

            snakeBoard_ctx.drawImage(
                foodImage,
                food_x,
                food_y,
                12, // width
                16 // height
            );

            /* snakeBoard_ctx.beginPath();
            snakeBoard_ctx.arc(food_x, food_y, 6, 0, 2 * Math.PI);
            snakeBoard_ctx.fillStyle = "brown";
            snakeBoard_ctx.stroke();
            snakeBoard_ctx.fill(); */
        }

        function random_food(min, max) {
            return Math.round((Math.random() * (max - min) + min) / 10) * 10;
        }

        function gen_food() {

            food_x = random_food(0, snakeBoard.width - 10);
            food_y = random_food(0, snakeBoard.height - 10);

            foodImage.src = list_food[Math.floor(Math.random() * list_food.length)];

            snake.forEach(function has_snake_eaten_food(part) {
                var has_eaten = part.x == food_x && part.y == food_y;
                if (has_eaten)
                    gen_food();
            });
        }

        function move_snake() {

            var head = {
                x: snake[0].x + dx,
                y: snake[0].y + dy
            };

            snake.unshift(head);
            var has_eaten_food = snake[0].x === food_x && snake[0].y === food_y;

            if (has_eaten_food) {
                gen_food();
            } else {
                snake.pop();
            }
        }

        function clear_Board() {
            // snakeBoard_ctx.fillStyle = snakeBoardBg;
            // snakeBoard_ctx.strokestyle = "orange";

            snakeBoard_ctx.fillRect(0, 0, snakeBoard.width, snakeBoard.height);
            snakeBoard_ctx.strokeRect(0, 0, snakeBoard.width, snakeBoard.height);
        }

        function has_game_ended() {

            for (let i = 4; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y)
                    return true

            }

            var hitLeftWall = snake[0].x < 0;
            var hitRightWall = snake[0].x > snakeBoard.width - 10;
            var hitToptWall = snake[0].y < 0;
            var hitBottomWall = snake[0].y > snakeBoard.height - 10;
            return hitLeftWall || hitRightWall || hitToptWall || hitBottomWall
        }

        main();

        function main() {

            if (has_game_ended())
                return;

            changing_direction = false;

            setTimeout(function onTick() {
                clear_Board();
                drawBackground();
                drawFood();
                move_snake();
                entered = false;
                drawSnake();
                main();
            }, 100)

        }

        var changing_direction = false;
        document.addEventListener("keydown", change_direction);

        function change_direction(event) {
            var LEFT_KEY = 37;
            var RIGHT_KEY = 39;
            var UP_KEY = 38;
            var DOWN_KEY = 40;
            var diff = 10;
            if (changing_direction)
                return;

            changing_direction = true;

            var keyPressed = event.keyCode;
            var goingUp = dy === - diff;
            var goingDown = dy === diff;
            var goingRight = dx === diff;
            var goingLeft = dx === - diff;

            if (keyPressed === LEFT_KEY && !goingRight) {
                dx = - diff;
                dy = 0;
                whichHead.src = './red4.jpg';
            }

            if (keyPressed === UP_KEY && !goingDown) {
                dx = 0;
                dy = - diff;
                whichHead.src = './red1.jpg';
            }

            if (keyPressed === RIGHT_KEY && !goingLeft) {
                dx = diff;
                dy = 0;
                whichHead.src = './red2.jpg';
            }

            if (keyPressed === DOWN_KEY && !goingUp) {
                dx = 0;
                dy = diff;
                whichHead.src = './red3.jpg';
            }

        }
    </script>
</body>

</html>